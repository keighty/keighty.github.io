
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Git Add -p - keighty</title>
  <meta name="author" content="katie leonard">

  
  <meta name="description" content="I learned a new tool that has quickly become an essential part of my workflow. git add -p lets you add small hunks of modified code to the index from &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.katieleonard.ca/blog/2014/git-add-p">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="keighty" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41587719-1', 'auto');
  ga('send', 'pageview');

</script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">keighty</a></h1>
  
    <h2>reading, writing, rambling</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.katieleonard.ca" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects/index.html">Projects</a></li>
  <li><a href="/reads/index.html">Reads</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Git Add -p</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-01T20:51:09-08:00" pubdate data-updated="true">Feb 1<span>st</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I learned a new tool that has quickly become an essential part of my workflow. <code>git add -p</code><!--more--> lets you add small hunks of modified code to the index from your working tree in order to prepare your next commit.</p>

<p>The best refactors are small atomic changes, and while I may not always work incrementally, I still want my git history to reflect the ideal. I use <code>git add -p</code> before every commit to ensure that each code change is intentional.</p>

<figure class='code'><figcaption><span>An example from my latest test project.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git add -p
</span><span class='line'>diff --git a/send.rb b/send.rb
</span><span class='line'>index 5e89eaf..a0f25b6 100644
</span><span class='line'>--- a/send.rb
</span><span class='line'>+++ b/send.rb
</span><span class='line'>@@ -17,5 +17,5 @@ <span class="nv">queue</span> <span class="o">=</span> channel.queue<span class="o">(</span><span class="s2">&quot;hello&quot;</span><span class="o">)</span>
</span><span class='line'> channel.default_exchange.publish<span class="o">(</span><span class="s2">&quot;Hello world!&quot;</span>, :routing_key <span class="o">=</span>&gt; q.name<span class="o">)</span>
</span><span class='line'> puts <span class="s2">&quot; [x] Sent &#39;Hello World!&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>-# close the connection
</span><span class='line'>-conn.close
</span><span class='line'><span class="se">\ </span>No newline at end of file
</span><span class='line'>+#close the connection
</span><span class='line'>+connection.close
</span><span class='line'>Stage this hunk <span class="o">[</span>y,n,q,a,d,/,e,?<span class="o">]</span>?
</span></code></pre></td></tr></table></div></figure>


<p>Woah &mdash; that is a lot of information&hellip; lets go through by the numbers:</p>

<ol>
<li>the initial command</li>
<li>tells me that it is showing the changes made in the send.rb file. &lsquo;a&rsquo; is the version already in the commit history, and &lsquo;b&rsquo; is the copy in the working directory.</li>
<li>shows the commit SHA range for this branch</li>
<li>tells me that lines marked with a &lsquo;&ndash;&rsquo; are from the committed version of send.rb</li>
<li>tells me that lines marked with a &lsquo;+&rsquo; are from the working directory version of send.rb</li>
<li><code>@@ -17,5 +17,5 @@</code> indicates that the hunk under scrutiny begins at line 17 of the committed version (&lsquo;-17&rsquo;) and affects 5 lines. It corresponds to the working directory version starting at line 17 (&lsquo;+17&rsquo;), also affecting 5 lines.</li>
<li>the remaining lines contain the details of the changes in the hunk.</li>
</ol>


<h3>Know your options</h3>

<p>Now that you have a hunk, what can you do with it?</p>

<figure class='code'><figcaption><span>Type &#8216;?&#8217; to learn what you can do with your hunk</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...
</span><span class='line'>Stage this hunk <span class="o">[</span>y,n,q,a,d,/,e,?<span class="o">]</span> ?
</span><span class='line'>y - stage this hunk
</span><span class='line'>n - <span class="k">do </span>not stage this hunk
</span><span class='line'>q - quit, <span class="k">do </span>not stage this hunk nor any of the remaining ones
</span><span class='line'>a - stage this and all the remaining hunks in the file
</span><span class='line'>d - <span class="k">do </span>not stage this hunk nor any of the remaining hunks in the file
</span><span class='line'>g - <span class="k">select </span>a hunk to go to
</span><span class='line'>/ - search <span class="k">for </span>a hunk matching the given regex
</span><span class='line'>j - leave this hunk undecided, see next undecided hunk
</span><span class='line'>J - leave this hunk undecided, see next hunk
</span><span class='line'>k - leave this hunk undecided, see previous undecided hunk
</span><span class='line'>K - leave this hunk undecided, see previous hunk
</span><span class='line'>s - split the current hunk into smaller hunks
</span><span class='line'>e - manually edit the current hunk
</span><span class='line'>? - print <span class="nb">help</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first few options are obvious choices &mdash; <code>y</code> (&ldquo;Yes, please!&rdquo;), and <code>n</code> (&ldquo;What was I thinking there?&rdquo;), as well as <code>q</code> (&ldquo;Hey, Jane! Get me off this crazy thing!&rdquo;).</p>

<p>I haven&rsquo;t quite got a handle on the middle options, but I have skimmed down and used <code>s</code> to split the hunk into smaller pieces. Split will only divide a hunk if there is a logical place for separation, like a gap between changes. For real index-finesse and line-by-line control you have to&hellip; edit the hunk (gasp).</p>

<p>Seasoned veterans may blanch at the thought of editing a hunk without a GUI, but I have discovered the secret to command-line-hunk-editing-prowess. The secret is:</p>

<h2>Read the instructions</h2>

<p>Revisiting the earlier example, I choose <code>e</code> to edit my hunk. I think the original comment on line 10 is better than the new one on line 13 (spacy == better). Selecting <code>e</code> opens your editor of choice with the now familiar hunk, along with&hellip;</p>

<p>Lo, and behold! Instructions after the hunk!</p>

<p><img src="/images/addp-hunk-edit_diff-8.png"></p>

<p>Simple enough:</p>

<ul>
<li><code>-# close the connection</code> becomes <code># close the connection</code> &mdash; mind the space!</li>
<li>remove <code>+#close the connection</code> entirely</li>
<li>save and close.</li>
</ul>


<p>Success? If you have done everything right, the hunk will be staged and git will move on to the next hunk in your working directory. If you have made an error you will see the following message:</p>

<figure class='code'><figcaption><span>Type &#8216;?&#8217; to learn what you can do with your hunk</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Your edited hunk does not apply.
</span><span class='line'>Edit again <span class="o">(</span>saying <span class="s2">&quot;no&quot;</span> discards!<span class="o">)</span> <span class="o">[</span>y/n<span class="o">]</span>?
</span></code></pre></td></tr></table></div></figure>


<p>Aw nuts. <code>y</code> will let you amend your transgressions (did you remember to save? did you forget to leave a space in place of the &lsquo;&ndash;&rsquo;?), and <code>n</code> will abandon your changes and take you back to the drawing board, where you are free to transgress anew.</p>

<p>Awesome.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">katie leonard</span></span>

      








  


<time datetime="2014-02-01T20:51:09-08:00" pubdate data-updated="true">Feb 1<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/git/'>git</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.katieleonard.ca/blog/2014/git-add-p/" data-via="KeightyLeonard" data-counturl="http://www.katieleonard.ca/blog/2014/git-add-p/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/git-retrieve/" title="Previous Post: git retrieve: a drama">&laquo; git retrieve: a drama</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/a-number-is-a-double-is-a-float/" title="Next Post: a number is a double is a float">a number is a double is a float &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <div class='contact'>
    <a href='mailto:keighty.leonard@gmail.com?Subject=Hello!' rel='tooltip' title='keighty.leonard@gmail.com'><i class="fa fa-envelope fa-3x"></i></a>
    <a href='http://twitter.com/KeightyLeonard' title='@KeightyLeonard'><i class="fa fa-twitter fa-3x"></i></a>
    <a href='http://github.com/keighty' title='github.com/keighty'><i class="fa fa-github fa-3x"></i></a>
    <a href='http://linkedin.com/in/katieleonard' title='linkedin/katieleonard'><i class="fa fa-linkedin fa-3x"></i></a>
  </div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/get-your-foot-in-the-door/">Getting Your Foot in the Door</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/what-is-it-like-to-be-a-programmer/">What's It Like to Be a Developer?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/exploring-the-stack/">Exploring the Stack</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/troubleshooting-nested-scopes-in-angular/">Troubleshooting Nested Scopes in Angular</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/more-git-goodies/">More Git Goodies</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'keighty',
            count: 4,
            skip_forks: true,
            skip_repos: [ "keighty.github.io" ],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <div>
    <h1>Aboot me</h1>
    <p>I have loved programming since my first "Hello World!", and have been seeking source code enlightenment through Java, Ruby, Rails, and JavaScript. I am also a recent immigrant to Portland, Oregon - perhaps you can tell from my Canadian accent?</p>
  </div>
</section>


<section class="well">
  <h1><a href="http://coderwall.com/keighty">@keighty</a> on Coderwall</h1>

  <div id="coderwall_badges"></div>

  <script type="text/javascript">
    $(document).ready(function(){
      $.getJSON("http://coderwall.com/keighty.json?callback=?", function(data){
        for(var i = 0; i < data.data.badges.length ; i++){
          var badge = data.data.badges[i];
          var description = badge.name + ":\n" + badge.description;
          var badge_tag = $("<img title='" + description + "'/>");
          badge_tag.attr("src",badge.badge);
          badge_tag.css("width","25%");
          $("#coderwall_badges").append(badge_tag);
        }
      });
    });
  </script>
</section>
 <section>
  <div>
    <h1>Twitter</h1>
    <a class="twitter-timeline" href="https://twitter.com/KeightyLeonard" data-widget-id="434861084550262784">Tweets by @KeightyLeonard</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </div>
 </section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - katie leonard -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'keightyleonard';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.katieleonard.ca/blog/2014/git-add-p/';
        var disqus_url = 'http://www.katieleonard.ca/blog/2014/git-add-p/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41587719-1', 'katieleonard.ca');
  ga('send', 'pageview');

</script>


</body>
</html>
