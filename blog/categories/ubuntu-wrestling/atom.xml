<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ubuntu Wrestling | keighty]]></title>
  <link href="http://www.katieleonard.ca/blog/categories/ubuntu-wrestling/atom.xml" rel="self"/>
  <link href="http://www.katieleonard.ca/"/>
  <updated>2015-01-20T07:40:43-08:00</updated>
  <id>http://www.katieleonard.ca/</id>
  <author>
    <name><![CDATA[katie leonard]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Mongo Trouble? Reset!]]></title>
    <link href="http://www.katieleonard.ca/blog/2014/mongo-trouble-reset/"/>
    <updated>2014-05-03T00:00:00-07:00</updated>
    <id>http://www.katieleonard.ca/blog/2014/mongo-trouble-reset</id>
    <content type="html"><![CDATA[<p>Back in March I wrote about letting my computer&rsquo;s battery die in the middle of a meteor project, with the consequence being that I could not connect to the underlying mongo database:
{% codeblock What&rsquo;s wrong, meteor? lang:bash %}
$ meteor
[[[[[ ~/project/in/progress ]]]]]</p>

<p>=> Started proxy.
Unexpected mongo exit code 100. Restarting.
Unexpected mongo exit code 100. Restarting.
Unexpected mongo exit code 100. Restarting.
Can&rsquo;t start Mongo server.
MongoDB had an unspecified uncaught exception.
This can be caused by MongoDB being unable to write to a local database.
Check that you have permissions to write to .meteor/local. MongoDB does
not support filesystems like NFS that do not allow file locking.
{% endcodeblock %}</p>

<p>After much spelunking in stackoverflow and documentation, I discovered the magic of this command:
{% codeblock Magic mongo reset spell lang:bash %%}
$ sudo -u mongodb mongdo &mdash;repair &mdash;dbpath /var/lib/mongodb
$ sudo service mongodb start
{% endcodeblock %}</p>

<p>Repairing and restarting the mongo service seemed to do the trick, and I continued on my merry meteor way. Well, I did it again &mdash; I let my battery die in the middle of a meteor project, and with feelings of smug satisfaction, I plumbed my blog archive for the answer. Only this time the magic antidote didn&rsquo;t work<!--more-->:</p>

<p>{% codeblock This log has been redacted to protect the ignorant %}
$ sudo -u mongodb mongod &mdash;repair &mdash;dbpath /var/lib/mongodb/
[sudo] password for keighty:
Sat May  3 09:52:04.793 [initandlisten] finished checking dbs
Sat May  3 09:52:04.793 dbexit:
Sat May  3 09:52:04.793 [initandlisten] shutdown: going to close listening sockets&hellip;
Sat May  3 09:52:04.793 [initandlisten] shutdown: going to flush diaglog&hellip;
Sat May  3 09:52:04.793 [initandlisten] shutdown: going to close sockets&hellip;
Sat May  3 09:52:04.793 [initandlisten] shutdown: waiting for fs preallocator&hellip;
Sat May  3 09:52:04.793 [initandlisten] shutdown: closing all files&hellip;
Sat May  3 09:52:04.793 [initandlisten] closeAllFiles() finished
Sat May  3 09:52:04.793 [initandlisten] shutdown: removing fs lock&hellip;
Sat May  3 09:52:04.794 dbexit: really exiting now</p>

<p>$ sudo service mongodb start
mongodb start/running, process 2415
$ meteor
[[[[[ ~/project/in/progress ]]]]]</p>

<p>=> Started proxy.
Unexpected mongo exit code 100. Restarting.
Unexpected mongo exit code 100. Restarting.
Unexpected mongo exit code 100. Restarting.
Can&rsquo;t start Mongo server.
MongoDB had an unspecified uncaught exception.
This can be caused by MongoDB being unable to write to a local database.
Check that you have permissions to write to .meteor/local. MongoDB does
not support filesystems like NFS that do not allow file locking.
{% endcodeblock %}</p>

<p>C'mon &mdash; It worked the last time! I tried it again with the same result. I tried <code>chown</code>-ing the local db. I tried <code>chown</code>-ing the database in <code>/var/lib/mongodb</code>. After each attempted solution the mongobd service would start, but meteor hiccuped on writing to the database. So I tried something radical. Something that wasn&rsquo;t in any of the manuals, or any of the <a href="http://stackoverflow.com/questions/5798549/why-cant-i-start-the-mongodb">responses to similar questions</a> on stackoverflow:</p>

<p>{% codeblock Really? That was all? lang:bash %}
$ meteor reset
Project reset.
$ meteor
[[[[[ ~/project/in/progress ]]]]]</p>

<p>=> Started proxy.
=> Started MongoDB.
=> Started your app.</p>

<p>=> App running at: <a href="http://localhost:3000/">http://localhost:3000/</a>
{% endcodeblock %}</p>

<p>Turns out that if you hard shut-down your computer while your meteor project&rsquo;s mongo instance is running, it remains in a locked mode. Since it was only a development database I took a chance that dropping it would cure my ills. Voila! Meteor and mongodb are friends again.</p>

<p>Awesome.</p>
]]></content>
  </entry>
  
</feed>
