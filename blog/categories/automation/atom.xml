<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Automation | keighty]]></title>
  <link href="http://www.katieleonard.ca/blog/categories/automation/atom.xml" rel="self"/>
  <link href="http://www.katieleonard.ca/"/>
  <updated>2014-01-12T11:26:33-08:00</updated>
  <id>http://www.katieleonard.ca/</id>
  <author>
    <name><![CDATA[katie leonard]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Thor Sets Up a Project]]></title>
    <link href="http://www.katieleonard.ca/blog/2013/thor-sets-up-a-project/"/>
    <updated>2013-09-08T00:00:00-07:00</updated>
    <id>http://www.katieleonard.ca/blog/2013/thor-sets-up-a-project</id>
    <content type="html"><![CDATA[<p>A few weeks ago I posted about <a href="http://www.katieleonard.ca/automation/2013/08/30/hammer-out-tasks-with-thor/">using Thor to generate system-wide notes files with a standard format</a>. Since then, I have been doing a lot of smaller code challenges, and I wanted to set up a Thor task for generating a standard project file tree.</p>

<p>My Goal Tree:
{% highlight bash %}
project_name
├── lib
│   └── project_name.rb
├── spec
│   ├── project_name_spec.rb
│   └── spec_helper.rb
├── Gemfile
└── README.md{% endhighlight %}</p>

<p>I always begin with these files and this organization. A Gemfile and README are essential for setting up the environment and explaining the gist of the project. I am most comfortable with RSpec, and to get into the practice of TDD, setting up a testing environment right away is non-negotiable. All of these standard files contain some automatic content as well:</p>

<h5>spec_helper.rb loads the library</h5>

<p>{% highlight ruby %}
$LOAD_PATH.unshift(File.join(File.dirname(<strong>FILE</strong>), &lsquo;..&rsquo;, &lsquo;lib&rsquo;))
require &lsquo;rspec&rsquo;
require &lsquo;project_name&rsquo;
{% endhighlight %}</p>

<h5>project_name_spec.rb sets up the first test</h5>

<p>{% highlight ruby %}
require &lsquo;spec_helper&rsquo;</p>

<p>describe ProjectName do
  before (:each) {  }
  subject {  }</p>

<p>  it &ldquo;should pass&rdquo;
end
{% endhighlight %}</p>

<h5>Gemfile specifies the right gems for setting up the project</h5>

<p>{% highlight ruby %}
ruby &lsquo;2.0.0&rsquo;
gem &lsquo;rspec&rsquo;
{% endhighlight %}</p>

<p>There are other files that could have auto-generated content as well, like a Rakefile, or a config.ru, but this is a good start.</p>

<h4>Create a Thor task (rb_project.thor):</h4>

<p>{% highlight ruby %}</p>

<h1>!/usr/bin/env ruby</h1>

<p>require &ldquo;rubygems&rdquo;
require &ldquo;thor&rdquo;</p>

<p>class RbProject &lt; Thor
  desc &ldquo;init&rdquo;, &ldquo;creates a ruby project with rspec&rdquo;</p>

<p>  def init(title=&ldquo;new_project&rdquo;)</p>

<pre><code>Dir.mkdir(title)
Dir.chdir(title)
Dir.mkdir("spec")
Dir.mkdir("lib")
filename = "#{title}"

open(File.new("README.md", "w"), "w") do |note|
  note.puts "# #{title}"
end

open(File.new("Gemfile", "w"), "w") do |my_gem|
  my_gem.puts "ruby '2.0.0'"
  my_gem.puts "gem 'rspec'"
end

open(File.new("spec/spec_helper.rb", "w"), "w") do |spec|
  spec.puts "$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))"
  spec.puts "require 'rspec'"
  spec.puts "require '#{filename}'"
end

open(File.new("spec/#{filename}_spec.rb", "w"), "w") do |spec|
  spec.puts "require 'spec_helper'"
  spec.puts ""
  spec.puts "describe #{camelize(filename)} do"
  spec.puts "  before (:each) {  }"
  spec.puts "  xit 'should pass'"
  spec.puts "end"
end
</code></pre>

<p>  end</p>

<p>  private</p>

<pre><code>def camelize(snake)
  title = snake.split('_').each do |word|
    word.capitalize!
  end
  title.join('')
end
</code></pre>

<p>end {% endhighlight %}</p>

<p>I created a private method camelize in order to change the snake_case project name into a CamelCase class name.</p>

<p>As before, I install my thor task system wide:
{% highlight bash %}
$ thor install rb_project.thor {% endhighlight %}</p>

<p>And now my project generation task can be run from any directory, anywhere on my system:
{% highlight bash %}
$ thor list</p>

<h2>note</h2>

<p>thor note:create  # creates a notes file in markdown</p>

<h2>rb_project</h2>

<p>thor rb_project:init  # creates a ruby project with rspec</p>

<p>$ thor rb_project:init test_project
$ tree test_project/
test_project/
├── lib
│   └── test_project.rb
├── spec
│   ├── spec_helper.rb
│   └── test_project_spec.rb
├── Gemfile
├── README.md</p>

<p>2 directories, 6 files
{% endhighlight %}</p>

<p>Awesome.</p>

<p>{% highlight bash %}{% endhighlight %}
{% highlight bash %}{% endhighlight %}</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hammer-out Tasks With Thor]]></title>
    <link href="http://www.katieleonard.ca/blog/2013/hammer-out-tasks-with-thor/"/>
    <updated>2013-08-30T00:00:00-07:00</updated>
    <id>http://www.katieleonard.ca/blog/2013/hammer-out-tasks-with-thor</id>
    <content type="html"><![CDATA[<p>A few months ago I gave a small lightning talk to my code school class about automating tasks using <a href="http://rake.rubyforge.org/">Rake</a>. Before I learned ruby I used bash scripts to accomplish similar things, but was often bogged down in learning the syntax of string-processing essentials like awk or sed. I wished for the simplicity of Ruby, and thought that Rake was the bees-knees. After my talk, <a href="chuckvose.com">Chuck</a>, my PCS mentor, put together a repo of <a href="http://whatisthor.com/">Thor</a> tasks that accomplished the same tasks but could be installed system wide.</p>

<h3><a href="http://whatisthor.com/">Thor</a> is my new hero</h3>

<p>Unlike Rake tasks, which are confined to the directory containing the Rakefile, Thor tasks can be installed on your system and called from anywhere. My note files are all formatted in a particular way. Before Thor, I used a rake task:</p>

<p>{% highlight bash %}
$ cd notesDirWithRakefile
$ rake post title=&ldquo;new post title&rdquo;
$ Creating new post: &ldquo;./130830_new_post_title&rdquo;{% endhighlight %}</p>

<p>The Rake task auto-formats the filename, replacing spaces with underscores, and prepends today&rsquo;s date so that they will sort in the order they are made. This worked great for when I wanted to keep notes in that one folder, but later I wanted to be able to keep notes on a particular project. I would either have to copy the Rakefile (two places to update if I made any changes), or create a symbolic link (which would break if I ever moved my Rakefile). Neither of these options seemed to be the most practical. Enter Thor:</p>

<p>Creating the Thor task is as easy as pie:
{% highlight ruby %}
require &lsquo;thor&rsquo;</p>

<p>class Note &lt; Thor
  desc &ldquo;create&rdquo;, &ldquo;creates a notes file in markdown&rdquo;
  def create(title=&ldquo;new note&rdquo;)</p>

<pre><code>slug = title.downcase.strip.gsub(' ', '_').gsub(/[^\w-]/, '')
date = Time.parse(Time.now).strftime('%y%m%d')
filename = File.join("./", "#{date}_#{slug}.md")

if File.exist?(filename)
  abort("rake aborted!") if ask("#{filename} already exists. Do you want to overwrite?", ['y', 'n']) == 'n'
end

puts "Creating new post: #{filename}"
open(filename, 'w') do |post|
  post.puts "# #{title.gsub(/-/,' ').capitalize}"
end
</code></pre>

<p>  end
end {% endhighlight %}</p>

<p>Listing all Thor tasks is easy:
{% highlight bash %}
$ thor list</p>

<h2>note</h2>

<p>thor note:create  # creates a notes file in markdown {% endhighlight %}</p>

<p>Installing a Thor task for system use is easy:
{% highlight bash %}
$ thor install notes.thor
&hellip;
Do you wish to continue [y/N]? y
Please specify a name for notes.thor in the system repository [notes.thor]: note
Storing thor file in your system repository {% endhighlight %}</p>

<p>Uninstalling a Thor task is easy:
{% highlight bash %}
$ thor uninstall note
Uninstalling note.
Done. {% endhighlight %}</p>

<p>With my Thor notes task installed system-wide, I can create a note page in any directory, for any reason, without copying code.</p>

<p>Awesome.</p>
]]></content>
  </entry>
  
</feed>
